{"remainingRequest":"/home/winter/Projects/Medical_Image_Detection_System_For_COVID19/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/winter/Projects/Medical_Image_Detection_System_For_COVID19/frontend/src/components/Record.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/winter/Projects/Medical_Image_Detection_System_For_COVID19/frontend/src/components/Record.vue","mtime":1618797961494},{"path":"/home/winter/Projects/Medical_Image_Detection_System_For_COVID19/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/winter/Projects/Medical_Image_Detection_System_For_COVID19/frontend/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/winter/Projects/Medical_Image_Detection_System_For_COVID19/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/winter/Projects/Medical_Image_Detection_System_For_COVID19/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmNvbnN0IGNvbHVtbnMgPSBbCiAgewogICAgZGF0YUluZGV4OiAibmFtZSIsCiAgICBrZXk6ICJuYW1lIiwKICAgIHNsb3RzOiB7IHRpdGxlOiAiY3VzdG9tVGl0bGUiIH0sCiAgICBzY29wZWRTbG90czogeyBjdXN0b21SZW5kZXI6ICJuYW1lIiB9LAogIH0sCiAgewogICAgdGl0bGU6ICLml7bpl7QiLAogICAgZGF0YUluZGV4OiAidGltZSIsCiAgICBrZXk6ICJ0aW1lIiwKICB9LAogIHsKICAgIHRpdGxlOiAi5pWw6YePIiwKICAgIGRhdGFJbmRleDogIm51bSIsCiAgICBrZXk6ICJudW0iLAogIH0sCiAgewogICAgdGl0bGU6ICLnsbvlnosiLAogICAgZGF0YUluZGV4OiAiY2F0ZWdvcnkiLAogICAga2V5OiAiY2F0ZWdvcnkiLAogICAgc2NvcGVkU2xvdHM6IHsgY3VzdG9tUmVuZGVyOiAiY2F0ZWdvcnkiIH0sCiAgfSwKICB7CiAgICB0aXRsZTogIuiviuaWrSIsCiAgICBrZXk6ICJkaWFnbm9zaXMiLAogICAgZGF0YUluZGV4OiAiZGlhZ25vc2lzIiwKICAgIHNjb3BlZFNsb3RzOiB7IGN1c3RvbVJlbmRlcjogImRpYWdub3NpcyIgfSwKICB9LAogIHsKICAgIHRpdGxlOiAi5pON5L2cIiwKICAgIGtleTogImFjdGlvbiIsCiAgICBzY29wZWRTbG90czogeyBjdXN0b21SZW5kZXI6ICJhY3Rpb24iIH0sCiAgfSwKXTsKCmNvbnN0IGRhdGEgPSBbXTsKaW1wb3J0IHJlcXdlc3QgZnJvbSAicmVxd2VzdCI7CmltcG9ydCB7IGdldENvb2tpZSB9IGZyb20gIi4uL3V0aWxzL2Nvb2tpZS5qcyI7CmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGF0YSwKICAgICAgY29sdW1ucywKICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgbGV0IF90b2tlbiA9IGdldENvb2tpZSgidG9rZW4iKTsKICAgIGlmIChfdG9rZW4gPT09IHVuZGVmaW5lZCB8fCBfdG9rZW4gPT0gIiIpIHsKICAgICAgdGhpcy4kcm91dGVyLnJlcGxhY2UoIi9Mb2dpbiIpOwogICAgfSBlbHNlIHsKICAgICAgcmVxd2VzdCh7CiAgICAgICAgdXJsOiAiaHR0cDovLzEyNy4wLjAuMTo1MDAwL2dldFJlY29yZCIsCiAgICAgICAgbWV0aG9kOiAiZ2V0IiwKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICB0b2tlbjogX3Rva2VuLAogICAgICAgIH0sCiAgICAgICAgZGF0YToge30sCiAgICAgICAgc3VjY2VzczogKGUpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJzdWNlc3MiLCBlKTsKICAgICAgICAgIHRoaXMuZGF0YSA9IGU7CiAgICAgICAgfSwKICAgICAgICBlcnJvcjogKCkgPT4ge30sCiAgICAgIH0pOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgc2hvd0RldGFpbChyZWNvcmQpIHsKICAgICAgY29uc29sZS5sb2cocmVjb3JkKTsKICAgICAgdGhpcy4kcm91dGVyLnJlcGxhY2UoewogICAgICAgIG5hbWU6ICJEZXRhaWwiLAogICAgICAgIHBhcmFtczogewogICAgICAgICAgZHJlY29yZDogcmVjb3JkLmtleSwKICAgICAgICB9LAogICAgICB9KTsKICAgIH0sCiAgICBjb25maXJtRGVsZXRlKGUpIHsKICAgICAgY29uc29sZS5sb2coImRlbGV0ZSIsIGUpOwogICAgICAvLyDmj5DkuqTmnI3liqHlmagKICAgICAgcmVxd2VzdCh7CiAgICAgICAgdXJsOiAiaHR0cDovLzEyNy4wLjAuMTo1MDAwL2RlbGV0ZVJlY29yZCIsCiAgICAgICAgbWV0aG9kOiAiZ2V0IiwKICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICB0b2tlbjogZ2V0Q29va2llKCJ0b2tlbiIpLAogICAgICAgIH0sCiAgICAgICAgZGF0YTogeyBkcmVjb3JkOiBlLmtleSB9LAogICAgICAgIHN1Y2Nlc3M6IChlKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZygic3VjZXNzIiwgZSk7CiAgICAgICAgfSwKICAgICAgICBlcnJvcjogKCkgPT4ge30sCiAgICAgIH0pOwogICAgICAvLyDmm7TmlrDmnKzlnLAKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5kYXRhW2ldLmtleSA9PSBlLmtleSkgdGhpcy5kYXRhLnNwbGljZShpLCAxKTsKICAgICAgfQogICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIuWIoOmZpOaIkOWKnyIpOwogICAgfSwKICAgIC8vIOWwhuebkeWQrOaTjeS9nOWGmeWcqG1ldGhvZHPph4zpnaLvvIxyZW1vdmVFdmVudExpc3RlbmVy5Y+W5raI55uR5ZCs5YaF5a655b+F6aG76Lef5byA5ZCv55uR5ZCs5L+d5oyB5LiA6Ie0CiAgICBiYWNrQ2hhbmdlKCkgewogICAgICB0aGlzLiRlbWl0KCJjaGFuZ2UiLCBmYWxzZSk7CiAgICB9LAogICAgLy8g5LiL6L29CiAgICBkb3dubG9hZChyZWNvcmQpIHsKICAgICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CgogICAgICB4aHIub3BlbigKICAgICAgICAiR0VUIiwKICAgICAgICAiaHR0cDovLzEyNy4wLjAuMTo1MDAwL2Rvd25sb2FkUmVjb3JkIiArCiAgICAgICAgICBlbmNvZGVVUkkoIj9kcmVjb3JkPSIgKyByZWNvcmQua2V5KSwKICAgICAgICB0cnVlCiAgICAgICk7CiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCJ0b2tlbiIsIGdldENvb2tpZSgidG9rZW4iKSk7CiAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAiYmxvYiI7CiAgICAgIHhoci5vbmVycm9yID0gZnVuY3Rpb24gKCkgewogICAgICAgIGFsZXJ0KCLor7fmsYLlpLHotKUiKTsKICAgICAgfTsKICAgICAgeGhyLm9ubG9hZCA9ICgpID0+IHsKICAgICAgICBpZiAoeGhyLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygieGhyIHN1Y2VzcyIsIHhocik7CiAgICAgICAgICBpZiAoeGhyLnJlc3BvbnNlLnR5cGUgPT0gImFwcGxpY2F0aW9uL2pzb24iKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKHhoci5yZXNwb25zZS50eXBlICE9ICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW3hoci5yZXNwb25zZV0sIHsgdHlwZTogImFwcGxpY2F0aW9uL3ppcCIgfSk7CiAgICAgICAgICBjb25zdCB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgICAgIGEuaHJlZiA9IHVybDsKICAgICAgICAgIGEuZG93bmxvYWQgPSAiMS56aXAiOwogICAgICAgICAgYS5jbGljaygpOwogICAgICAgICAgd2luZG93LlVSTC5yZXZva2VPYmplY3RVUkwodXJsKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICB4aHIuc2VuZCgpOwogICAgICAvLyBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAvLyBhLnNldEF0dHJpYnV0ZSgiaHJlZiIsIGhyZWYpOwogICAgICAvLyBhLnNldEF0dHJpYnV0ZSgiZG93bmxvYWQiLCB0aXRsZSk7CiAgICAgIC8vIGEuY2xpY2soKTsKICAgIH0sCiAgfSwKICAvLyDmjILovb3lrozmiJDlkI7vvIzliKTmlq3mtY/op4jlmajmmK/lkKbmlK/mjIFwb3BzdGF0ZQogIG1vdW50ZWQoKSB7CiAgICBpZiAod2luZG93Lmhpc3RvcnkgJiYgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKSB7CiAgICAgIC8vIOW+gOWOhuWPsuiusOW9lemHjOmdoua3u+WKoOS4gOadoeaWsOeahOW9k+WJjemhtemdoueahHVybAogICAgICBoaXN0b3J5LnB1c2hTdGF0ZShudWxsLCBudWxsLCBkb2N1bWVudC5VUkwpOwogICAgICAvLyDnu5kgcG9wc3RhdGUg57uR5a6a5LiA5Liq5pa55rOVIOebkeWQrOmhtemdouWIt+aWsAogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9wc3RhdGUiLCB0aGlzLmJhY2tDaGFuZ2UsIGZhbHNlKTsKICAgIH0KICB9LAoKICAvLyDpobXpnaLplIDmr4Hml7bvvIzlj5bmtojnm5HlkKzjgILlkKbliJnlhbbku5Z2dWXot6/nlLHpobXpnaLkuZ/kvJrooqvnm5HlkKwKICBkZXN0cm95ZWQoKSB7CiAgICAvLyB3aW5kb3cucmVtb3ZlTGlzdGVuZXIoInBvcHN0YXRlIiwgdGhpcy5iYWNrQ2hhbmdlLCBmYWxzZSk7CiAgfSwKfTsK"},{"version":3,"sources":["Record.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"Record.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <a-table :columns=\"columns\" :data-source=\"data\">\n    <a slot=\"name\" slot-scope=\"text\">{{ text }}</a>\n    <span slot=\"customTitle\"><a-icon type=\"smile-o\" /> 名称</span>\n    <span slot=\"category\" slot-scope=\"category\">\n      <a-tag\n        :key=\"category\"\n        :color=\"\n          category.toUpperCase() === 'CXR' ? 'CornflowerBlue' : 'BurlyWood '\n        \"\n      >\n        {{ category.toUpperCase() }}\n      </a-tag>\n    </span>\n    <span slot=\"diagnosis\" slot-scope=\"diagnosis\">\n      <a-tag\n        :key=\"diagnosis\"\n        :color=\"\n          diagnosis === 'COVID-19'\n            ? 'red'\n            : diagnosis === 'CAP'\n            ? 'yellow'\n            : 'green'\n        \"\n      >\n        {{ diagnosis.toUpperCase() }}\n      </a-tag>\n    </span>\n    <span slot=\"action\" slot-scope=\"record\">\n      <a-divider type=\"vertical\" />\n      <a-popconfirm\n        title=\"Are you sure delete this task?\"\n        ok-text=\"Yes\"\n        cancel-text=\"No\"\n        @confirm=\"confirmDelete(record)\"\n      >\n        <a class=\"ant-dropdown-lin\">删除</a>\n      </a-popconfirm>\n\n      <a-divider type=\"vertical\" />\n      <a class=\"ant-dropdown-link\" @click=\"download(record)\"> 下载 </a>\n      <a-divider type=\"vertical\" />\n      <a class=\"ant-dropdown-link\" @click=\"showDetail(record)\"> 详情 </a>\n    </span>\n  </a-table>\n</template>\n<script>\nconst columns = [\n  {\n    dataIndex: \"name\",\n    key: \"name\",\n    slots: { title: \"customTitle\" },\n    scopedSlots: { customRender: \"name\" },\n  },\n  {\n    title: \"时间\",\n    dataIndex: \"time\",\n    key: \"time\",\n  },\n  {\n    title: \"数量\",\n    dataIndex: \"num\",\n    key: \"num\",\n  },\n  {\n    title: \"类型\",\n    dataIndex: \"category\",\n    key: \"category\",\n    scopedSlots: { customRender: \"category\" },\n  },\n  {\n    title: \"诊断\",\n    key: \"diagnosis\",\n    dataIndex: \"diagnosis\",\n    scopedSlots: { customRender: \"diagnosis\" },\n  },\n  {\n    title: \"操作\",\n    key: \"action\",\n    scopedSlots: { customRender: \"action\" },\n  },\n];\n\nconst data = [];\nimport reqwest from \"reqwest\";\nimport { getCookie } from \"../utils/cookie.js\";\nexport default {\n  data() {\n    return {\n      data,\n      columns,\n    };\n  },\n  created() {\n    let _token = getCookie(\"token\");\n    if (_token === undefined || _token == \"\") {\n      this.$router.replace(\"/Login\");\n    } else {\n      reqwest({\n        url: \"http://127.0.0.1:5000/getRecord\",\n        method: \"get\",\n        headers: {\n          token: _token,\n        },\n        data: {},\n        success: (e) => {\n          console.log(\"sucess\", e);\n          this.data = e;\n        },\n        error: () => {},\n      });\n    }\n  },\n  methods: {\n    showDetail(record) {\n      console.log(record);\n      this.$router.replace({\n        name: \"Detail\",\n        params: {\n          drecord: record.key,\n        },\n      });\n    },\n    confirmDelete(e) {\n      console.log(\"delete\", e);\n      // 提交服务器\n      reqwest({\n        url: \"http://127.0.0.1:5000/deleteRecord\",\n        method: \"get\",\n        headers: {\n          token: getCookie(\"token\"),\n        },\n        data: { drecord: e.key },\n        success: (e) => {\n          console.log(\"sucess\", e);\n        },\n        error: () => {},\n      });\n      // 更新本地\n      for (let i = 0; i < this.data.length; i++) {\n        if (this.data[i].key == e.key) this.data.splice(i, 1);\n      }\n      this.$message.success(\"删除成功\");\n    },\n    // 将监听操作写在methods里面，removeEventListener取消监听内容必须跟开启监听保持一致\n    backChange() {\n      this.$emit(\"change\", false);\n    },\n    // 下载\n    download(record) {\n      const xhr = new XMLHttpRequest();\n\n      xhr.open(\n        \"GET\",\n        \"http://127.0.0.1:5000/downloadRecord\" +\n          encodeURI(\"?drecord=\" + record.key),\n        true\n      );\n      xhr.setRequestHeader(\"token\", getCookie(\"token\"));\n      xhr.responseType = \"blob\";\n      xhr.onerror = function () {\n        alert(\"请求失败\");\n      };\n      xhr.onload = () => {\n        if (xhr.status === 200) {\n          console.log(\"xhr sucess\", xhr);\n          if (xhr.response.type == \"application/json\") {\n            console.log(xhr.response.type != \"application/json\");\n            return;\n          }\n          const a = document.createElement(\"a\");\n          const blob = new Blob([xhr.response], { type: \"application/zip\" });\n          const url = window.URL.createObjectURL(blob);\n          a.href = url;\n          a.download = \"1.zip\";\n          a.click();\n          window.URL.revokeObjectURL(url);\n        }\n      };\n\n      xhr.send();\n      // const a = document.createElement(\"a\");\n      // a.setAttribute(\"href\", href);\n      // a.setAttribute(\"download\", title);\n      // a.click();\n    },\n  },\n  // 挂载完成后，判断浏览器是否支持popstate\n  mounted() {\n    if (window.history && window.history.pushState) {\n      // 往历史记录里面添加一条新的当前页面的url\n      history.pushState(null, null, document.URL);\n      // 给 popstate 绑定一个方法 监听页面刷新\n      window.addEventListener(\"popstate\", this.backChange, false);\n    }\n  },\n\n  // 页面销毁时，取消监听。否则其他vue路由页面也会被监听\n  destroyed() {\n    // window.removeListener(\"popstate\", this.backChange, false);\n  },\n};\n</script>\n"]}]}